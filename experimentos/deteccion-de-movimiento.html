<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://unpkg.com/@tensorflow/tfjs-core@2.4.0/dist/tf-core.js"></script>
    <script src="https://unpkg.com/@tensorflow/tfjs-converter@2.4.0/dist/tf-converter.js"></script>
    <script src="https://unpkg.com/@tensorflow/tfjs-backend-webgl@2.4.0/dist/tf-backend-webgl.js"></script>
    <script src="https://unpkg.com/@tensorflow-models/face-landmarks-detection@0.0.1/dist/face-landmarks-detection.js"></script>
    <script src="../src/movement-detection.js"></script>
    <title> Detección de movimiento </title>
  </head>
  <body>
    <div>
      <button
        id="calibration-starter"
        disabled
      >
        Iniciar calibración
      </button>
      <button
        id="valid-position-adder"
        disabled
      >
        Agregar posición válida
      </button>
      <button
        id="detection-starter"
        disabled
      >
        Pasar a detección
      </button>
      <button
        id="detector-stoper"
        disabled
      >
        Frenar detección
      </button>
    </div>
    <video id="webcam-output">Video stream not available.</video>
    <p
      id="calibration-instructions"
      hidden
    >
      Presioná la barra de espacio para agregar posiciones válidas.
    </p>

    <script>
      document.addEventListener('movement-detector:ready', () => {
        const videoElement = document.getElementById('webcam-output')
        videoElement.srcObject = movementDetector.videoStream
        videoElement.play()

        const calibrationStarterButton = document.getElementById('calibration-starter')
        const detectionStarterButton = document.getElementById('detection-starter')
        const stoperButton = document.getElementById('detector-stoper')
        const adderButton = document.getElementById('valid-position-adder')

        calibrationStarterButton.disabled = false
        calibrationStarterButton.addEventListener('click', () => {
          movementDetector.start.calibration()
          calibrationStarterButton.disabled = true
          detectionStarterButton.disabled = false
          stoperButton.disabled = false
          document.getElementById('calibration-instructions').hidden = false
        })
        detectionStarterButton.addEventListener('click', () => {
          movementDetector.start.detection()
          calibrationStarterButton.disabled = true
          detectionStarterButton.disabled = true
          stoperButton.disabled = false
          document.getElementById('calibration-instructions').hidden = true
        })
        stoperButton.addEventListener('click', () => {
          movementDetector.stop()
          calibrationStarterButton.disabled = false
          detectionStarterButton.disabled = true
          stoperButton.disabled = true
          document.getElementById('calibration-instructions').hidden = true
        })
      })
    </script>
  </body>
</html>
